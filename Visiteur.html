<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animaux √† Vendre - FarmsConnect</title>
    <link rel="icon" type="image/png" href="img/FarmsConnect.jpg"> <!-- Chemin vers votre image -->
    <link rel="stylesheet" href="style_Visiter.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script type="text/javascript" src="cordova.js"></script>

</head>
<body>    


<!-- Message de chargement -->
<div id="loadingMessage" class="hidden">
    <div class="spinner-container">
        <img src="img/FarmsConnect.jpg" alt="Chargement" class="spinner-image" />
        <div class="spinner"></div>
    </div>
    <p class="loading-text">Veuillez patientez </p> 
</div>






<script>
window.onload = function() {
    // Afficher le message de chargement d√®s que la page est charg√©e
    var loadingMessage = document.getElementById('loadingMessage');
    loadingMessage.classList.remove('hidden');  // Afficher le message de chargement

    // Masquer le message de chargement apr√®s 5 secondes (5000 ms)
    setTimeout(function() {
        loadingMessage.classList.add('hidden');  // Cacher le message de chargement
    }, 7000);  // Temps en millisecondes
};
</script>


    <header class="header">
     <div class="logo-container">
            <h2 class="logo">Animaux Disponibles</h2>
            <h4>Mis en ligne par des vendeurs</h4>
        </div>
        <nav class="nav">
            <input type="checkbox" id="menu-toggle" class="menu-toggle">
            <label for="menu-toggle" class="menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </label>
            <ul class="nav-list">
                <li><a href="Acceuil.html">Accueil</a></li>
                <li><a href="Vente.html">Vendre</a></li>
                <li><a href="Visiteur.html">Visiter</a></li>
                <li><a href="Produit.html">Acheter Avec FarmsConnect</a></li>
                <li><a href="apropos.html">√Ä propos</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="Formations.html">Vid√©os Formation</a></li>
            </ul>
        </nav>
        <div class="image-container">
            <img src="img/FarmsConnect.jpg" alt="Farms Connect" class="header-image">
        </div>
    </header>


    <button class="open-modal-button">Note Importante pour les Visiteurs</button>

    <!-- Fen√™tre modale pour les visiteurs -->
    <div id="modal-visitor" class="modal hidden">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Note Importante pour les Visiteurs</h2>
            <p><strong>Chers visiteurs,</strong></p>
            <p>
                Nous vous remercions pour l'int√©r√™t que vous portez √† nos produits sur <strong>FarmsConnect</strong> üå±. Avant de finaliser votre commande, voici quelques informations essentielles √† conna√Ætre :
            </p>
            <ol>
                <li>
                    <strong>üîç V√©rification de la qualit√© des produits</strong><br>
                    Chaque produit propos√© sur notre plateforme subit un contr√¥le v√©t√©rinaire de qualit√© sup√©rieure avant la mise en vente üêÑüíâ. Nous garantissons que tous nos animaux sont en parfaite sant√© et respectent des normes de s√©curit√© strictes üõ°Ô∏è.
                </li>
                <li>
                    <strong>üõí Processus de commande simplifi√©</strong><br>
                    Une fois que vous avez trouv√© l'animal ou le produit qui vous int√©resse, vous pouvez passer votre commande en toute s√©curit√© üîí. Nous nous occupons de toute la logistique et assurons la livraison jusqu'√† chez vous üööüí®.
                </li>
                <li>
                    <strong>üè° Livraison rapide √† domicile</strong><br>
                    Apr√®s validation du contr√¥le v√©t√©rinaire, votre commande sera exp√©di√©e directement √† votre adresse üì¶. Vous recevrez une notification instantan√©e lorsque votre produit est en route üì≤üìç.
                </li>
            </ol>
            <p>
                <strong>Nous nous engageons √† vous offrir un service de qualit√© et √† garantir la s√©curit√© des produits que vous achetez. üíØ</strong>
            </p>
            <p class="support-message">Pour toute question ou assistance, notre √©quipe de support est pr√™te √† vous aider ü§ó. N'h√©sitez pas √† nous contacter ! <a href="https://wa.me/+22656663638" target="_blank">Cliquez ici pour contacter sur WhatsApp</a></p>            <p class="signature">Cordialement,<br><em>L‚Äô√©quipe FarmsConnect üöú</em></p>
        </div>
    </div>

    <button id="refreshButton">Rafra√Æchir la page</button>

    <script>
        // Attacher un √©v√©nement de clic au bouton
        document.getElementById('refreshButton').addEventListener('click', function() {
            // Rafra√Æchir la page lorsque le bouton est cliqu√©
            location.reload();
        });
    </script>


<section class="categories">
    <div class="category-list">
        <button class="category-button" data-category="poulet-local">Poulet local</button>
        <button class="category-button" data-category="poulet-chair">Poulet de chair</button>
        <button class="category-button" data-category="poulet-ameliorer">Poulet Am√©lior√©</button>
        <button class="category-button" data-category="poule-pondeuse">Poule Pondeuse</button>    </div>
</section>


<!-- Section pour les boutons de prix -->
<div id="price-buttons" class="hidden">
    <button class="price-button" data-price="0-500">0-500 FCFA</button>
    <button class="price-button" data-price="501-1000">501-1000 FCFA</button>
    <button class="price-button" data-price="1001-2000">1001-2000 FCFA</button>
    <button class="price-button" data-price="2001-5000">2001-5000 FCFA</button>
    <button class="price-button" data-price="5000+">5000 FCFA & +</button>
</div>

<!-- Section o√π les annonces filtr√©es seront affich√©es -->
<section class="animals-list" id="animals-list"></section>
<div id="pagination" class="pagination-container"></div>




<script>
    // S√©lectionner tous les boutons de cat√©gorie
const categoryButtons = document.querySelectorAll('.category-button');

// S√©lectionner la section des boutons de prix
const priceButtons = document.getElementById('price-buttons');

// Ajouter un √©v√©nement de clic sur chaque bouton de cat√©gorie
categoryButtons.forEach(button => {
    button.addEventListener('click', () => {
        // Afficher les boutons de prix lorsque l'un des boutons de cat√©gorie est cliqu√©
        priceButtons.style.display = 'flex';
    });
});

</script>




<script>
    document.addEventListener("DOMContentLoaded", () => {
        const animalsList = document.getElementById("animals-list");
        const categoriesButtons = document.querySelectorAll(".category-button");
        const priceButtonsSection = document.getElementById("price-buttons");

        const itemsPerPage = 6;
        let selectedCategory = "";
        let selectedPriceRange = "";
        let filteredAnnonces = [];
        let allAnnonces = []; // Stockage des annonces r√©cup√©r√©es depuis l'API
        let currentPage = 1;

        // Fonction d'affichage des annonces
        function displayAnnonces(annonces) {
            annonces.forEach((animal) => {
                const animalCard = document.createElement("div");
                animalCard.classList.add("animal-card", "animate__animated", "animate__fadeInUp");

                const mainImage = animal.images[0] || "";
                const additionalImages = animal.images.slice(1).map((img) => `<img src="${img}" alt="Image suppl√©mentaire" class="additional-image">`).join("");

                animalCard.innerHTML = `
                    <div class="animal-card-header">
                        <h3 class="category-name">üìÇ (${animal.categorie})</h3>
                        <p>üîñ Num√©ro d'annonce  : ${animal.codeVendeur}</p>
                    </div>
                    <div class="animal-card-body">
                        <p>üì¶ Nombre : ${animal.nombre}</p>
                        <p>‚öñÔ∏è Poids : ${animal.poids || "Non sp√©cifi√©"} kg</p>
                        <p><strong>üíµ Prix : ${animal.prixFinal} FCFA</strong></p>
                        <div class="images-section">
                        <img src="${mainImage}" alt="Image de l'animal" class="animal-image" loading="lazy">
                            <div class="additional-images hidden">${additionalImages}</div>
                            ${animal.images.length > 1 ? `<button class="see-more-button">üëÅÔ∏è Voir plus</button>` : ""}
                        </div>
                    </div>
                    <div class="animal-card-footer">
                        <button class="buy-button" data-animal='${JSON.stringify(animal)}'>üõí Acheter</button>
                    </div>
                `;

                animalsList.appendChild(animalCard);
            });

            addEventListenersToButtons();
        }

        // Fonction d'affichage de la pagination
        function displayPagination(totalItems, currentPage) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            if (currentPage < totalPages) {
                loadMoreAnnonces();
            }
        }

        // Fonction pour charger plus d'annonces
        function loadMoreAnnonces() {
            if (filteredAnnonces.length > 0) {
                const startIndex = (currentPage - 1) * itemsPerPage;
                const paginatedAnnonces = filteredAnnonces.slice(startIndex, startIndex + itemsPerPage);
                displayAnnonces(paginatedAnnonces);
                currentPage++;
            }
        }

        // Fonction de filtrage des annonces
        function filterAnnonces() {
            let filtered = allAnnonces;

            if (selectedCategory) {
                filtered = filtered.filter((animal) => animal.categorie === selectedCategory);
            }

            if (selectedPriceRange) {
                filtered = filtered.filter((animal) => {
                    const price = animal.prixFinal;
                    if (selectedPriceRange === "0-500") return price <= 500;
                    if (selectedPriceRange === "501-1000") return price > 500 && price <= 1000;
                    if (selectedPriceRange === "1001-2000") return price > 1000 && price <= 2000;
                    if (selectedPriceRange === "2001-5000") return price > 2000 && price <= 5000;
                    if (selectedPriceRange === "5000+") return price > 5000;
                    return false;
                });
            }

            filteredAnnonces = filtered;
            currentPage = 1; // R√©initialiser la page actuelle
            animalsList.innerHTML = ""; // Effacer les annonces existantes
            loadMoreAnnonces(); // Charger les premi√®res annonces
        }

        // Fonction d'ajout des √©couteurs d'√©v√©nements sur les boutons
        function addEventListenersToButtons() {
            document.querySelectorAll(".see-more-button").forEach((button) => {
                button.addEventListener("click", () => {
                    const additionalImages = button.previousElementSibling;
                    additionalImages.classList.toggle("hidden");
                    button.textContent = additionalImages.classList.contains("hidden") ? "üëÅÔ∏è Voir plus" : "üëÅÔ∏è Voir moins";
                });
            });

            document.querySelectorAll(".buy-button").forEach((button) => {
                button.addEventListener("click", () => {
                    const animal = JSON.parse(button.getAttribute("data-animal"));
                    handlePurchase(animal);
               });
            });
        }

        // R√©cup√©ration des annonces depuis l'API
        fetch("https://farmsconnect.netlify.app/api/annonces")
            .then((response) => response.json())
            .then((annonces) => {
                allAnnonces = annonces; // Stockage des annonces pour filtrage futur

                categoriesButtons.forEach((button) => {
                    button.addEventListener("click", () => {
                        selectedCategory = button.getAttribute("data-category");
                        priceButtonsSection.classList.remove("hidden");
                        filterAnnonces();
                    });
                });

                priceButtonsSection.querySelectorAll(".price-button").forEach((button) => {
                    button.addEventListener("click", () => {
                        selectedPriceRange = button.getAttribute("data-price");
                        filterAnnonces();
                    });
                });

                // Ajouter l'√©couteur d'√©v√©nements pour la pagination infinie
                window.addEventListener("scroll", () => {
                    if (window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 500) {
                        loadMoreAnnonces();
                    }
                });
            })
            .catch((error) => console.error("Erreur lors de la r√©cup√©ration des annonces :", error));
    });
</script>
        
<script>

// Variable globale pour stocker la localisation
let userLocation = null;

// V√©rification si Cordova est disponible
if (typeof cordova !== "undefined") {
    document.addEventListener("deviceready", function () {
        checkGPSStatusAndRequestPermission();
    });
} else {
    // Fallback si Cordova n'est pas disponible
    checkGPSStatusAndRequestPermission();
}

// Fonction pour v√©rifier si le GPS est activ√© et demander la permission
function checkGPSStatusAndRequestPermission() {
    if (typeof cordova !== "undefined" && cordova.plugins.diagnostic) {
        const diagnostic = cordova.plugins.diagnostic;

        // V√©rifie si le GPS est activ√©
        diagnostic.isLocationEnabled(function (enabled) {
            if (!enabled) {
                // Si le GPS n'est pas activ√©, on tente de l'activer automatiquement
                diagnostic.switchToLocationSettings(function () {
                    console.log("L'utilisateur a √©t√© redirig√© vers les param√®tres pour activer le GPS.");
                }, function (error) {
                    console.error("Erreur lors de la redirection vers les param√®tres : ", error);
                });
            }
            // Demander la permission de localisation
            requestLocationPermission();
        }, function (error) {
            console.error("Erreur lors de la v√©rification de l'√©tat du GPS : ", error);
        });
    } else {
        // Si Cordova n'est pas disponible, utiliser l'API de g√©olocalisation standard
        requestLocationPermission();
    }
}

// Fonction pour demander les permissions de localisation via Cordova
function requestLocationPermission() {
    if (typeof cordova !== "undefined" && cordova.plugins.permissions) {
        const permissions = cordova.plugins.permissions;

        // V√©rifie si la permission est d√©j√† accord√©e
        permissions.checkPermission(permissions.ACCESS_FINE_LOCATION, (status) => {
            if (!status.hasPermission) {
                // Si la permission n'est pas accord√©e, on la demande
                permissions.requestPermission(
                    permissions.ACCESS_FINE_LOCATION,
                    () => {
                        console.log("Permission de localisation accord√©e !");
                        getLocation(); // R√©cup√®re la localisation apr√®s avoir obtenu la permission
                    },
                    () => {
                        console.error("Permission de localisation refus√©e.");
                        alert("L'application a besoin de la localisation pour fonctionner correctement.");
                    }
                );
            } else {
                console.log("Permission de localisation d√©j√† accord√©e.");
                getLocation(); // Si la permission est d√©j√† accord√©e, on r√©cup√®re la localisation
            }
        }, (error) => {
            console.error("Erreur lors de la v√©rification des permissions :", error);
        });
    } else {
        // Si Cordova n'est pas disponible, utilise l'API de g√©olocalisation standard
        getLocation();
    }
}

// Fonction pour r√©cup√©rer la localisation de l'utilisateur
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                // Localisation r√©ussie
                userLocation = {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                };
                console.log("Localisation obtenue :", userLocation);
            },
            (error) => {
                handleGeolocationError(error);
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0,
            }
        );
    } else {
        alert("La g√©olocalisation n'est pas support√©e par votre appareil.");
    }
}

// Gestion des erreurs de g√©olocalisation
function handleGeolocationError(error) {
    let message = "";

    switch (error.code) {
        case error.PERMISSION_DENIED:
            message = "L'acc√®s √† la localisation a √©t√© refus√©.";
            break;
        case error.POSITION_UNAVAILABLE:
            message = "La localisation est indisponible.";
            break;
        case error.TIMEOUT:
            message = "Le temps pour obtenir la localisation a expir√©. Assurez-vous que votre GPS est activ√©.";
            break;
        default:
            message = "Une erreur inconnue est survenue.";
            break;
    }

    alert(`Erreur de localisation : ${message}`);
}


let isInfoCollected = false; // Flag pour v√©rifier si les informations ont d√©j√† √©t√© collect√©es

// Fonction pour g√©rer l'achat d'un produit/animal
function handlePurchase(animal) {
    // Si les informations ont d√©j√† √©t√© collect√©es, on n'affiche pas les prompt
    if (isInfoCollected) {
        processEmails(animal);
        return;
    }

    const visitorInfo = {
        username: validateUsername(),
        contact: validateContact(),
        email: validateEmail(),
        quantity: validateQuantity(),
        quartier: validateQuartier(),
    };

    // Arr√™te l'ex√©cution si une donn√©e est manquante
    if (Object.values(visitorInfo).includes(null)) {
        alert("L'achat a √©t√© annul√© ou des informations sont manquantes.");
        return;
    }

    // Si toutes les informations sont valides, on met √† jour le flag
    isInfoCollected = true;

    // V√©rifie si la localisation est disponible avant de continuer
    if (!userLocation) {
        alert("La localisation de l'utilisateur n'est pas encore disponible.");
        return;
    }

    // Cr√©ation des d√©tails d'achat avec la localisation globale
    const purchaseDetails = {
        animalId: animal._id,
        animalName: animal.categorie,
        email: visitorInfo.email,
        username: visitorInfo.username,
        contact: visitorInfo.contact,
        quantity: visitorInfo.quantity,
        quartier: visitorInfo.quartier,
        location: userLocation, // Utilise la localisation globale ici
    };

console.log("D√©tails de l'achat :", purchaseDetails);
console.log(visitorInfo);  // V√©rifier si `quantity` est d√©fini ici
processEmails(animal, visitorInfo, purchaseDetails);

}

// Validation pour le champ "Nom et Pr√©nom"
function validateUsername() {
        let username;
        do {
            username = prompt("Veuillez entrer votre nom et pr√©nom.");

            if (username === null) {
                alert("Action annul√©e par l'utilisateur.");
                return null;
            }

            if (!username || username.trim().length < 3) {
                alert("Veuillez entrer un Nom et Pr√©nom valides (au moins 3 caract√®res).");
            }
        } while (!username || username.trim().length < 3);
        return username.trim();
    }

    // Validation pour le champ "Num√©ro de t√©l√©phone"
// Validation pour le champ "Num√©ro de t√©l√©phone"
function validateContact() {
    const phoneRegex = /^\d{8}$/; // Format : num√©ro de 8 chiffres

    while (true) {
        // Demander √† l'utilisateur d'entrer son num√©ro de t√©l√©phone
        const contact = prompt("Entrez votre num√©ro de t√©l√©phone :");

        // V√©rifier si l'utilisateur a annul√© l'action
        if (contact === null) {
            alert("Action annul√©e par l'utilisateur.");
            return null; // Retourne null si l'utilisateur annule
        }

        // V√©rifier si le num√©ro est valide
        if (phoneRegex.test(contact)) {
            return contact; // Retourne le num√©ro valide
        }

        // Message d'erreur si le num√©ro est invalide
        alert("Veuillez entrer un num√©ro de t√©l√©phone valide (8 chiffres).");
    }
}

    // Validation pour l'email avec confirmation
    function validateEmail() {
        let email, confirmEmail;
        do {
            email = prompt("Votre adresse e-mail :");

            if (email === null) {
                alert("Action annul√©e par l'utilisateur.");
                return null;
            }

            confirmEmail = prompt("Confirmez votre adresse e-mail :");

            if (confirmEmail === null) {
                alert("Action annul√©e par l'utilisateur.");
                return null;
            }

            if (email !== confirmEmail || !isValidEmail(email)) {
                alert("Les emails ne correspondent pas ou sont invalides. Veuillez r√©essayer.");
            }
        } while (email !== confirmEmail || !isValidEmail(email));
        return email;
    }

    // V√©rification du format de l'email
    function isValidEmail(email) {
        const emailRegex = /^\S+@\S+\.\S+$/;
        return emailRegex.test(email);
    }

function validateQuantity() {
    let quantity;
    do {
        quantity = prompt("Combien d'unit√©s de ce produit souhaitez-vous acheter ?");

        if (quantity === null) {
            alert("Action annul√©e par l'utilisateur.");
            return null;
        }

        if (isNaN(quantity) || quantity <= 0) {
            alert("Veuillez entrer une quantit√© valide (nombre sup√©rieur √† 0).");
        }
    } while (isNaN(quantity) || quantity <= 0);
    return parseInt(quantity);  // Assurez-vous que vous renvoyez un nombre
}

    // Validation pour le quartier
    function validateQuartier() {
        let quartier;
        do {
            quartier = prompt("Quel est votre Quartier ?");

            if (quartier === null) {
                alert("Action annul√©e par l'utilisateur.");
                return null;
            }

            if (!quartier || quartier.trim().length < 2) {
                alert("Veuillez entrer un Quartier valide (au moins 2 caract√®res).");
            }
        } while (!quartier || quartier.trim().length < 2);
        return quartier.trim();
    }

    

async function processEmails(animal, visitorInfo, purchaseDetails) {
    try {
        console.log("Calcul du total et affichage de l'alerte");
        const totalPrice = (animal.prix * visitorInfo.quantity * 1.04 + 500).toLocaleString();
        alert(`Merci ${visitorInfo.username} ! Le total √† payer est : ${totalPrice} FCFA (inclut 500 FCFA de frais de traitement)`);

        // Email pour le vendeur
        const emailSubjectVendeur = "üì¢ Int√©r√™t pour votre annonce sur FarmsConnect !";
        const emailContentVendeur = `
Bonjour ${animal.usernameVendeur}

Nous avons le plaisir de vous informer qu'un client est int√©ress√© par votre annonce. Voici les d√©tails de la commande :

üîπ Cat√©gorie : ${animal.categorie}  
üîπ Quantit√© demand√©e : ${visitorInfo.quantity}  
üîπ Nom du client : ${visitorInfo.username}  
üîñ Num√©ro de l'annonce : ${animal.codeVendeur}  
üí∞ Recette estim√©e : ${(animal.prix * visitorInfo.quantity).toLocaleString()} FCFA  

üì¶ FarmsConnect vous contactera bient√¥t pour organiser la livraison.  

Merci d'utiliser FarmsConnect, votre partenaire de confiance !

Cordialement,  
L‚Äô√©quipe FarmsConnect 

        `;
        console.log("Envoi de l'email au vendeur");
        console.log("Email du vendeur :", animal.emailVendeur);
        await sendEmail(emailSubjectVendeur, emailContentVendeur, animal.emailVendeur);

        // Email pour le client 
        const emailSubjectClient = "üü¢Votre achat a √©t√© confirm√© avec succ√®s."
        const emailContentClient = `
Bonjour ${visitorInfo.username},

Merci pour votre commande ! Voici les d√©tails de votre achat :  

üîπ Cat√©gorie : ${animal.categorie}  
üîπ Quantit√© demand√©e : ${visitorInfo.quantity}  
üí∞ Total √† payer : ${totalPrice} FCFA _(inclut 500 FCFA de frais de traitement)_  
üöö Livraison : Gratuite  
üîñ Num√©ro de l'annonce : ${animal.codeVendeur}  

Nous vous contacterons prochainement pour organiser la livraison.  

Merci de faire confiance √† FarmsConnect ! 
Vous avez des questions ? Contactez-nous üëâ [Cliquez ici pour WhatsApp](https://wa.me/+22656663638)

Cordialement,  
L‚Äô√©quipe FarmsConnect 
        `;
        console.log("Envoi de l'email au client");
        await sendEmail(emailSubjectClient, emailContentClient, visitorInfo.email);

        // Email pour FarmsConnect
        const emailSubjectFarmsConnect = "üî¥Nouvelle commande enregistr√©e sur FarmsConnect";
        const emailContentFarmsConnect = `
Bonjour FarmsConnect,

Une nouvelle commande a √©t√© pass√©e avec succ√®s. Voici les d√©tails :  

üë§ Vendeur :  
üîπ Nom : ${animal.usernameVendeur}
üîπ Contact : ${animal.contactPrincipal}  
üîπ Cat√©gorie : ${animal.categorie}  
üîñ Num√©ro de l'annonce : ${animal.codeVendeur}  
üìç Localisation : Latitude ${animal.location.latitude}, Longitude ${animal.location.longitude}  

üë§ Acheteur :  
üîπ Nom : ${visitorInfo.username}  
üîπ Contact : ${visitorInfo.contact}  
üîπ E-mail : ${visitorInfo.email}  
üîπ Quartier : ${visitorInfo.quartier}  
üì¶ Quantit√© demand√©e : ${visitorInfo.quantity}  

üí∞ Total √† payer : ${totalPrice} FCFA  
üìç Coordonn√©es d'achat : Latitude ${purchaseDetails.location.latitude}, Longitude ${purchaseDetails.location.longitude}  

Merci de confirmer cette commande et de planifier la livraison.

Cordialement,  
L‚Äô√©quipe FarmsConnect 
        `;
        console.log("Envoi de l'email √† FarmsConnect");
        await sendEmail(emailSubjectFarmsConnect, emailContentFarmsConnect, "kaboreabwa2020@gmail.com");

        console.log("Planification de l'email client");
        await scheduleClientEmail(purchaseDetails);

        console.log("Affichage de l'alerte de confirmation");
        showAlert("Votre achat a √©t√© confirm√© ! Un email contenant les d√©tails de votre achat vous a √©t√© envoy√©.");
    } catch (error) {
        console.error("Erreur lors du traitement des emails :", error);
    }
}

// Fonction g√©n√©rique pour envoyer un email
function sendEmail(subject, content, email) {
    fetch('https://farmsconnect.netlify.app/api/send-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subject, content, email })
    }).then(response => {
        if (response.ok) {
            console.log(`Email envoy√© avec succ√®s √† ${email}.`);
        } else {
            console.error(`Erreur lors de l'envoi de l'email √† ${email}.`);
            response.text().then(text => console.error("D√©tail de l'erreur :", text));
        }
    }).catch(error => {
        console.error(`Erreur r√©seau lors de l'envoi de l'email √† ${email} :`, error);
    });
}

// Planification de l'email pour le client
function scheduleClientEmail(purchaseDetails) {
    fetch('https://farmsconnect.netlify.app/api/schedule-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ purchaseDetails, delay: 24 })
    }).then(response => {
        if (response.ok) {
            console.log("Email planifi√© pour le client dans 24h.");
        } else {
            console.error("Erreur lors de la planification de l'email.");
        }
    }).catch(error => console.error("Erreur r√©seau lors de la planification de l'email :", error));
}



</script>    
    
        </script>
                
            

    <script src="script_Visiter.js"></script>

    <div class="alert hidden" id="customAlert">
        <div class="alert-content">
            <img src="img/FarmsConnect.jpg" alt="FarmsConnect Logo" class="alert-image">
            <p id="alertMessage"></p>
            <button class="alert-close-button" onclick="closeAlert()">√ó</button>
        </div>
    </div>


</body>
</html>
