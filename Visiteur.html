<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animaux Ã  Vendre - FarmsConnect</title>
    <link rel="icon" type="image/png" href="img/FarmsConnect.jpg"> <!-- Chemin vers votre image -->
    <link rel="stylesheet" href="style_Visiter.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script type="text/javascript" src="cordova.js"></script>

</head>
<body>    


<!-- Message de chargement -->
<div id="loadingMessage" class="hidden">
    <div class="spinner-container">
        <img src="img/FarmsConnect.jpg" alt="Chargement" class="spinner-image" />
        <div class="spinner"></div>
    </div>
    <p class="loading-text">Veuillez patientez </p> 
</div>






<script>
window.onload = function() {
    // Afficher le message de chargement dÃ¨s que la page est chargÃ©e
    var loadingMessage = document.getElementById('loadingMessage');
    loadingMessage.classList.remove('hidden');  // Afficher le message de chargement

    // Masquer le message de chargement aprÃ¨s 5 secondes (5000 ms)
    setTimeout(function() {
        loadingMessage.classList.add('hidden');  // Cacher le message de chargement
    }, 7000);  // Temps en millisecondes
};
</script>


    <header class="header">
     <div class="logo-container">
            <h2 class="logo">Animaux Disponibles</h2>
            <h4>Mis en ligne par des vendeurs</h4>
        </div>
        <nav class="nav">
            <input type="checkbox" id="menu-toggle" class="menu-toggle">
            <label for="menu-toggle" class="menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </label>
            <ul class="nav-list">
                <li><a href="Acceuil.html">Accueil</a></li>
                <li><a href="Vente.html">Vendre</a></li>
                <li><a href="Visiteur.html">Visiter</a></li>
                <li><a href="Produit.html">Acheter Avec FarmsConnect</a></li>
                <li><a href="apropos.html">Ã€ propos</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="Formations.html">VidÃ©os Formation</a></li>
            </ul>
        </nav>
        <div class="image-container">
            <img src="img/FarmsConnect.jpg" alt="Farms Connect" class="header-image">
        </div>
    </header>


    <button class="open-modal-button">Note Importante pour les Visiteurs</button>

    <!-- FenÃªtre modale pour les visiteurs -->
    <div id="modal-visitor" class="modal hidden">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Note Importante pour les Visiteurs</h2>
            <p><strong>Chers visiteurs,</strong></p>
            <p>
                Nous vous remercions pour l'intÃ©rÃªt que vous portez Ã  nos produits sur <strong>FarmsConnect</strong> ğŸŒ±. Avant de finaliser votre commande, voici quelques informations essentielles Ã  connaÃ®tre :
            </p>
            <ol>
                <li>
                    <strong>ğŸ” VÃ©rification de la qualitÃ© des produits</strong><br>
                    Chaque produit proposÃ© sur notre plateforme subit un contrÃ´le vÃ©tÃ©rinaire de qualitÃ© supÃ©rieure avant la mise en vente ğŸ„ğŸ’‰. Nous garantissons que tous nos animaux sont en parfaite santÃ© et respectent des normes de sÃ©curitÃ© strictes ğŸ›¡ï¸.
                </li>
                <li>
                    <strong>ğŸ›’ Processus de commande simplifiÃ©</strong><br>
                    Une fois que vous avez trouvÃ© l'animal ou le produit qui vous intÃ©resse, vous pouvez passer votre commande en toute sÃ©curitÃ© ğŸ”’. Nous nous occupons de toute la logistique et assurons la livraison jusqu'Ã  chez vous ğŸššğŸ’¨.
                </li>
                <li>
                    <strong>ğŸ¡ Livraison rapide Ã  domicile</strong><br>
                    AprÃ¨s validation du contrÃ´le vÃ©tÃ©rinaire, votre commande sera expÃ©diÃ©e directement Ã  votre adresse ğŸ“¦. Vous recevrez une notification instantanÃ©e lorsque votre produit est en route ğŸ“²ğŸ“.
                </li>
            </ol>
            <p>
                <strong>Nous nous engageons Ã  vous offrir un service de qualitÃ© et Ã  garantir la sÃ©curitÃ© des produits que vous achetez. ğŸ’¯</strong>
            </p>
            <p class="support-message">Pour toute question ou assistance, notre Ã©quipe de support est prÃªte Ã  vous aider ğŸ¤—. N'hÃ©sitez pas Ã  nous contacter ! <a href="https://wa.me/+22656663638" target="_blank">Cliquez ici pour contacter sur WhatsApp</a></p>            <p class="signature">Cordialement,<br><em>Lâ€™Ã©quipe FarmsConnect ğŸšœ</em></p>
        </div>
    </div>

    <button id="refreshButton">RafraÃ®chir la page</button>

    <script>
        // Attacher un Ã©vÃ©nement de clic au bouton
        document.getElementById('refreshButton').addEventListener('click', function() {
            // RafraÃ®chir la page lorsque le bouton est cliquÃ©
            location.reload();
        });
    </script>


   <!-- Conteneur principal -->
   <section class="categories">
    <!-- Bouton principal pour afficher la liste -->
    <button id="toggleButton" class="toggle-button">Voir Les Annonces</button>
    
    <!-- Liste dÃ©roulante des catÃ©gories (cachÃ©e par dÃ©faut) -->
    <div id="categoryList" class="category-list">
        <button class="category-button" data-category="poulet-local">ğŸ” Poulet Local</button>
        <button class="category-button" data-category="poulet-chair">ğŸ“ Poulet de Chair</button>
        <button class="category-button" data-category="poulet-ameliorer">ğŸ”ğŸŒŸ Poulet AmÃ©liorÃ©</button>
        <button class="category-button" data-category="poule-pondeuse">ğŸ”ğŸ¥š Poule Pondeuse</button>
    </div>
</section>
<script>
   document.addEventListener("DOMContentLoaded", function () {
    const toggleButton = document.getElementById("toggleButton");
    const categoryList = document.getElementById("categoryList");
    const categoryButtons = document.querySelectorAll(".category-button");

    // Ã‰vÃ©nement pour afficher/masquer la liste
    toggleButton.addEventListener("click", function () {
        if (categoryList.classList.contains("show")) {
            categoryList.classList.remove("show");
            setTimeout(() => categoryList.style.display = "none", 300); // Retarde la disparition pour l'animation
        } else {
            categoryList.style.display = "block";
            setTimeout(() => categoryList.classList.add("show"), 10);
        }
    });

});

</script>



<!-- Section pour les boutons de prix -->
<div id="price-buttons" class="hidden">
    <button class="price-button" data-price="0-500">0-500 FCFA</button>
    <button class="price-button" data-price="501-1000">501-1000 FCFA</button>
    <button class="price-button" data-price="1001-2000">1001-2000 FCFA</button>
    <button class="price-button" data-price="2001-5000">2001-5000 FCFA</button>
    <button class="price-button" data-price="5000+">5000 FCFA & +</button>
</div>

<!-- Section oÃ¹ les annonces filtrÃ©es seront affichÃ©es -->
<section class="animals-list" id="animals-list"></section>
<div id="pagination" class="pagination-container"></div>




<script>
    // SÃ©lectionner tous les boutons de catÃ©gorie
const categoryButtons = document.querySelectorAll('.category-button');

// SÃ©lectionner la section des boutons de prix
const priceButtons = document.getElementById('price-buttons');

// Ajouter un Ã©vÃ©nement de clic sur chaque bouton de catÃ©gorie
categoryButtons.forEach(button => {
    button.addEventListener('click', () => {
        // Afficher les boutons de prix lorsque l'un des boutons de catÃ©gorie est cliquÃ©
        priceButtons.style.display = 'flex';
    });
});

</script>




<script>
    document.addEventListener("DOMContentLoaded", () => {
        const animalsList = document.getElementById("animals-list");
        const categoriesButtons = document.querySelectorAll(".category-button");
        const priceButtonsSection = document.getElementById("price-buttons");

        const itemsPerPage = 6;
        let selectedCategory = "";
        let selectedPriceRange = "";
        let filteredAnnonces = [];
        let allAnnonces = []; // Stockage des annonces rÃ©cupÃ©rÃ©es depuis l'API
        let currentPage = 1;

        // Fonction d'affichage des annonces
        function displayAnnonces(annonces) {
            annonces.forEach((animal) => {
                const animalCard = document.createElement("div");
                animalCard.classList.add("animal-card", "animate__animated", "animate__fadeInUp");

                const mainImage = animal.images[0] || "";
                const additionalImages = animal.images.slice(1).map((img) => `<img src="${img}" alt="Image supplÃ©mentaire" class="additional-image">`).join("");

                animalCard.innerHTML = `
                    <div class="animal-card-header">
                        <h3 class="category-name">ğŸ“‚ (${animal.categorie})</h3>
                        <p>ğŸ”– NumÃ©ro d'annonce  : ${animal.codeVendeur}</p>
                    </div>
                    <div class="animal-card-body">
                        <p>ğŸ“¦ Nombre : ${animal.nombre}</p>
                        <p>âš–ï¸ Poids : ${animal.poids || "Non spÃ©cifiÃ©"} kg</p>
                        <p><strong>ğŸ’µ Prix : ${animal.prixFinal} FCFA</strong></p>
                        <div class="images-section">
                        <img src="${mainImage}" alt="Image de l'animal" class="animal-image" loading="lazy">
                            <div class="additional-images hidden">${additionalImages}</div>
                            ${animal.images.length > 1 ? `<button class="see-more-button">ğŸ‘ï¸ Voir plus</button>` : ""}
                        </div>
                    </div>
                    <div class="animal-card-footer">
                        <button class="buy-button" data-animal='${JSON.stringify(animal)}'>ğŸ›’ Acheter</button>
                    </div>
                `;

                animalsList.appendChild(animalCard);
            });

            addEventListenersToButtons();
        }

        // Fonction d'affichage de la pagination
        function displayPagination(totalItems, currentPage) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            if (currentPage < totalPages) {
                loadMoreAnnonces();
            }
        }

        // Fonction pour charger plus d'annonces
        function loadMoreAnnonces() {
            if (filteredAnnonces.length > 0) {
                const startIndex = (currentPage - 1) * itemsPerPage;
                const paginatedAnnonces = filteredAnnonces.slice(startIndex, startIndex + itemsPerPage);
                displayAnnonces(paginatedAnnonces);
                currentPage++;
            }
        }

        // Fonction de filtrage des annonces
        function filterAnnonces() {
            let filtered = allAnnonces;

            if (selectedCategory) {
                filtered = filtered.filter((animal) => animal.categorie === selectedCategory);
            }

            if (selectedPriceRange) {
                filtered = filtered.filter((animal) => {
                    const price = animal.prixFinal;
                    if (selectedPriceRange === "0-500") return price <= 500;
                    if (selectedPriceRange === "501-1000") return price > 500 && price <= 1000;
                    if (selectedPriceRange === "1001-2000") return price > 1000 && price <= 2000;
                    if (selectedPriceRange === "2001-5000") return price > 2000 && price <= 5000;
                    if (selectedPriceRange === "5000+") return price > 5000;
                    return false;
                });
            }

            filteredAnnonces = filtered;
            currentPage = 1; // RÃ©initialiser la page actuelle
            animalsList.innerHTML = ""; // Effacer les annonces existantes
            loadMoreAnnonces(); // Charger les premiÃ¨res annonces
        }

        // Fonction d'ajout des Ã©couteurs d'Ã©vÃ©nements sur les boutons
        function addEventListenersToButtons() {
            document.querySelectorAll(".see-more-button").forEach((button) => {
                button.addEventListener("click", () => {
                    const additionalImages = button.previousElementSibling;
                    additionalImages.classList.toggle("hidden");
                    button.textContent = additionalImages.classList.contains("hidden") ? "ğŸ‘ï¸ Voir plus" : "ğŸ‘ï¸ Voir moins";
                });
            });

            document.querySelectorAll(".buy-button").forEach((button) => {
                button.addEventListener("click", () => {
                    const animal = JSON.parse(button.getAttribute("data-animal"));
                    handlePurchase(animal);
               });
            });
        }

        // RÃ©cupÃ©ration des annonces depuis l'API
        fetch("https://farmsconnect.netlify.app/.netlify/functions/annonces")
            .then((response) => response.json())
            .then((annonces) => {
                allAnnonces = annonces; // Stockage des annonces pour filtrage futur

                categoriesButtons.forEach((button) => {
                    button.addEventListener("click", () => {
                        selectedCategory = button.getAttribute("data-category");
                        priceButtonsSection.classList.remove("hidden");
                        filterAnnonces();
                    });
                });

                priceButtonsSection.querySelectorAll(".price-button").forEach((button) => {
                    button.addEventListener("click", () => {
                        selectedPriceRange = button.getAttribute("data-price");
                        filterAnnonces();
                    });
                });

                // Ajouter l'Ã©couteur d'Ã©vÃ©nements pour la pagination infinie
                window.addEventListener("scroll", () => {
                    if (window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 500) {
                        loadMoreAnnonces();
                    }
                });
            })
            .catch((error) => console.error("Erreur lors de la rÃ©cupÃ©ration des annonces :", error));
    });
</script>
        
<script>

// Variable globale pour stocker la localisation
let userLocation = null;

// VÃ©rification si Cordova est disponible
if (typeof cordova !== "undefined") {
    document.addEventListener("deviceready", checkGPSStatusAndRequestPermission);
} else {
    // Fallback si Cordova n'est pas disponible
    checkGPSStatusAndRequestPermission();
}

// Fonction pour vÃ©rifier si le GPS est activÃ© et demander la permission
function checkGPSStatusAndRequestPermission() {
    if (typeof cordova !== "undefined" && cordova.plugins.diagnostic) {
        const diagnostic = cordova.plugins.diagnostic;

        // VÃ©rifie si le GPS est activÃ©
        diagnostic.isLocationEnabled(
            (enabled) => {
                if (!enabled) {
                    // Redirection vers les paramÃ¨tres si GPS dÃ©sactivÃ©
                    diagnostic.switchToLocationSettings(
                        () => console.log("ğŸ”„ Redirection vers les paramÃ¨tres GPS."),
                        (error) => console.warn("âš ï¸ Impossible d'ouvrir les paramÃ¨tres GPS :", error)
                    );
                } else {
                    // Demande la permission seulement si GPS activÃ©
                    requestLocationPermission();
                }
            },
            (error) => console.error("âŒ Erreur lors de la vÃ©rification du GPS :", error)
        );
    } else {
        // Si Cordova n'est pas disponible, utiliser l'API de gÃ©olocalisation standard
        requestLocationPermission();
    }
}

// Fonction pour demander les permissions de localisation via Cordova
function requestLocationPermission() {
    if (typeof cordova !== "undefined" && cordova.plugins.permissions) {
        const permissions = cordova.plugins.permissions;

        // VÃ©rifie si la permission est dÃ©jÃ  accordÃ©e
        permissions.checkPermission(permissions.ACCESS_FINE_LOCATION, (status) => {
            if (status.hasPermission) {
                console.log("âœ… Permission de localisation dÃ©jÃ  accordÃ©e.");
                getLocation();
            } else {
                // Demande la permission
                permissions.requestPermission(
                    permissions.ACCESS_FINE_LOCATION,
                    (grantedStatus) => {
                        if (grantedStatus.hasPermission) {
                            console.log("âœ… Permission de localisation accordÃ©e !");
                            getLocation();
                        } else {
                            console.warn("âŒ Permission refusÃ©e.");
                            alert("ğŸ“ L'application a besoin de la localisation pour fonctionner.");
                        }
                    },
                    () => {
                        console.error("âŒ Erreur lors de la demande de permission.");
                        alert("ğŸš« Impossible d'obtenir la localisation sans permission.");
                    }
                );
            }
        }, (error) => console.error("âŒ Erreur lors de la vÃ©rification des permissions :", error));
    } else {
        // Si Cordova n'est pas disponible, utilise l'API de gÃ©olocalisation standard
        getLocation();
    }
}

// Fonction pour rÃ©cupÃ©rer la localisation de l'utilisateur
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                userLocation = {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                };
                console.log("ğŸ“ Localisation obtenue :", userLocation);
            },
            handleGeolocationError,
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0,
            }
        );
    } else {
        alert("ğŸš« La gÃ©olocalisation n'est pas supportÃ©e par votre appareil.");
    }
}

// Gestion des erreurs de gÃ©olocalisation
function handleGeolocationError(error) {
    let message = "";

    switch (error.code) {
        case error.PERMISSION_DENIED:
            message = "ğŸ“ L'accÃ¨s Ã  la localisation a Ã©tÃ© refusÃ©.";
            break;
        case error.POSITION_UNAVAILABLE:
            message = "âš ï¸ La localisation est indisponible.";
            break;
        case error.TIMEOUT:
            message = "â³ DÃ©lai dÃ©passÃ©. Activez le GPS et rÃ©essayez.";
            break;
        default:
            message = "âŒ Une erreur inconnue est survenue.";
            break;
    }

    alert(`Erreur de localisation : ${message}`);
}


let isInfoCollected = false; // Flag pour vÃ©rifier si les informations ont dÃ©jÃ  Ã©tÃ© collectÃ©es

// Fonction pour gÃ©rer l'achat d'un produit/animal
function handlePurchase(animal) {
    // Si les informations ont dÃ©jÃ  Ã©tÃ© collectÃ©es, on n'affiche pas les prompt
    if (isInfoCollected) {
        processEmails(animal);
        return;
    }

    const visitorInfo = {
        username: validateUsername(),
        contact: validateContact(),
        email: validateEmail(),
        quantity: validateQuantity(),
        quartier: validateQuartier(),
    };

    // ArrÃªte l'exÃ©cution si une donnÃ©e est manquante
    if (Object.values(visitorInfo).includes(null)) {
        alert("L'achat a Ã©tÃ© annulÃ© ou des informations sont manquantes.");
        return;
    }

    // Si toutes les informations sont valides, on met Ã  jour le flag
    isInfoCollected = true;

    // VÃ©rifie si la localisation est disponible avant de continuer
    if (!userLocation) {
        alert("La localisation de l'utilisateur n'est pas encore disponible.");
        return;
    }

    // CrÃ©ation des dÃ©tails d'achat avec la localisation globale
    const purchaseDetails = {
        animalId: animal._id,
        animalName: animal.categorie,
        email: visitorInfo.email,
        username: visitorInfo.username,
        contact: visitorInfo.contact,
        quantity: visitorInfo.quantity,
        quartier: visitorInfo.quartier,
        location: userLocation, // Utilise la localisation globale ici
    };

console.log("DÃ©tails de l'achat :", purchaseDetails);
console.log(visitorInfo);  // VÃ©rifier si `quantity` est dÃ©fini ici
processEmails(animal, visitorInfo, purchaseDetails);

}

// Validation pour le champ "Nom et PrÃ©nom"
function validateUsername() {
        let username;
        do {
            username = prompt("Veuillez entrer votre nom et prÃ©nom.");

            if (username === null) {
                alert("Action annulÃ©e par l'utilisateur.");
                return null;
            }

            if (!username || username.trim().length < 3) {
                alert("Veuillez entrer un Nom et PrÃ©nom valides (au moins 3 caractÃ¨res).");
            }
        } while (!username || username.trim().length < 3);
        return username.trim();
    }

    // Validation pour le champ "NumÃ©ro de tÃ©lÃ©phone"
// Validation pour le champ "NumÃ©ro de tÃ©lÃ©phone"
function validateContact() {
    const phoneRegex = /^\d{8}$/; // Format : numÃ©ro de 8 chiffres

    while (true) {
        // Demander Ã  l'utilisateur d'entrer son numÃ©ro de tÃ©lÃ©phone
        const contact = prompt("Entrez votre numÃ©ro de tÃ©lÃ©phone :");

        // VÃ©rifier si l'utilisateur a annulÃ© l'action
        if (contact === null) {
            alert("Action annulÃ©e par l'utilisateur.");
            return null; // Retourne null si l'utilisateur annule
        }

        // VÃ©rifier si le numÃ©ro est valide
        if (phoneRegex.test(contact)) {
            return contact; // Retourne le numÃ©ro valide
        }

        // Message d'erreur si le numÃ©ro est invalide
        alert("Veuillez entrer un numÃ©ro de tÃ©lÃ©phone valide (8 chiffres).");
    }
}

    // Validation pour l'email avec confirmation
    function validateEmail() {
        let email, confirmEmail;
        do {
            email = prompt("Votre adresse e-mail :");

            if (email === null) {
                alert("Action annulÃ©e par l'utilisateur.");
                return null;
            }

            confirmEmail = prompt("Confirmez votre adresse e-mail :");

            if (confirmEmail === null) {
                alert("Action annulÃ©e par l'utilisateur.");
                return null;
            }

            if (email !== confirmEmail || !isValidEmail(email)) {
                alert("Les emails ne correspondent pas ou sont invalides. Veuillez rÃ©essayer.");
            }
        } while (email !== confirmEmail || !isValidEmail(email));
        return email;
    }

    // VÃ©rification du format de l'email
    function isValidEmail(email) {
        const emailRegex = /^\S+@\S+\.\S+$/;
        return emailRegex.test(email);
    }

function validateQuantity() {
    let quantity;
    do {
        quantity = prompt("Combien d'unitÃ©s de ce produit souhaitez-vous acheter ?");

        if (quantity === null) {
            alert("Action annulÃ©e par l'utilisateur.");
            return null;
        }

        if (isNaN(quantity) || quantity <= 0) {
            alert("Veuillez entrer une quantitÃ© valide (nombre supÃ©rieur Ã  0).");
        }
    } while (isNaN(quantity) || quantity <= 0);
    return parseInt(quantity);  // Assurez-vous que vous renvoyez un nombre
}

    // Validation pour le quartier
    function validateQuartier() {
        let quartier;
        do {
            quartier = prompt("Quel est votre Quartier ?");

            if (quartier === null) {
                alert("Action annulÃ©e par l'utilisateur.");
                return null;
            }

            if (!quartier || quartier.trim().length < 2) {
                alert("Veuillez entrer un Quartier valide (au moins 2 caractÃ¨res).");
            }
        } while (!quartier || quartier.trim().length < 2);
        return quartier.trim();
    }

    

async function processEmails(animal, visitorInfo, purchaseDetails) {
    try {
        console.log("Calcul du total et affichage de l'alerte");
        const totalPrice = (animal.prix * visitorInfo.quantity * 1.04 + 500).toLocaleString();
        alert(`Merci ${visitorInfo.username} ! Le total Ã  payer est : ${totalPrice} FCFA (inclut 500 FCFA de frais de traitement)`);

        // Email pour le vendeur
        const emailSubjectVendeur = "ğŸ“¢ IntÃ©rÃªt pour votre annonce sur FarmsConnect !";
        const emailContentVendeur = `
Bonjour ${animal.usernameVendeur}

Nous avons le plaisir de vous informer qu'un client est intÃ©ressÃ© par votre annonce. Voici les dÃ©tails de la commande :

ğŸ”¹ CatÃ©gorie : ${animal.categorie}  
ğŸ”¹ QuantitÃ© demandÃ©e : ${visitorInfo.quantity}  
ğŸ”¹ Nom du client : ${visitorInfo.username}  
ğŸ”– NumÃ©ro de l'annonce : ${animal.codeVendeur}  
ğŸ’° Recette estimÃ©e : ${(animal.prix * visitorInfo.quantity).toLocaleString()} FCFA  

ğŸ“¦ FarmsConnect vous contactera bientÃ´t pour organiser la livraison.  

Merci d'utiliser FarmsConnect, votre partenaire de confiance !

Cordialement,  
Lâ€™Ã©quipe FarmsConnect 

        `;
        console.log("Envoi de l'email au vendeur");
        console.log("Email du vendeur :", animal.emailVendeur);
        await sendEmail(emailSubjectVendeur, emailContentVendeur, animal.emailVendeur);

        // Email pour le client 
        const emailSubjectClient = "ğŸŸ¢Votre achat a Ã©tÃ© confirmÃ© avec succÃ¨s."
        const emailContentClient = `
Bonjour ${visitorInfo.username},

Merci pour votre commande ! Voici les dÃ©tails de votre achat :  

ğŸ”¹ CatÃ©gorie : ${animal.categorie}  
ğŸ”¹ QuantitÃ© demandÃ©e : ${visitorInfo.quantity}  
ğŸ’° Total Ã  payer : ${totalPrice} FCFA _(inclut 500 FCFA de frais de traitement)_  
ğŸšš Livraison : Gratuite  
ğŸ”– NumÃ©ro de l'annonce : ${animal.codeVendeur}  

Nous vous contacterons prochainement pour organiser la livraison.  

Merci de faire confiance Ã  FarmsConnect ! 
Vous avez des questions ? Contactez-nous ğŸ‘‰ [Cliquez ici pour WhatsApp](https://wa.me/+22656663638)

Cordialement,  
Lâ€™Ã©quipe FarmsConnect 
        `;
        console.log("Envoi de l'email au client");
        await sendEmail(emailSubjectClient, emailContentClient, visitorInfo.email);

        // Email pour FarmsConnect
        const emailSubjectFarmsConnect = "ğŸ”´Nouvelle commande enregistrÃ©e sur FarmsConnect";
        const emailContentFarmsConnect = `
Bonjour FarmsConnect,

Une nouvelle commande a Ã©tÃ© passÃ©e avec succÃ¨s. Voici les dÃ©tails :  

ğŸ‘¤ Vendeur :  
ğŸ”¹ Nom : ${animal.usernameVendeur}
ğŸ”¹ Contact : ${animal.contactPrincipal}  
ğŸ”¹ CatÃ©gorie : ${animal.categorie}  
ğŸ”– NumÃ©ro de l'annonce : ${animal.codeVendeur} 
ğŸ’° Recette estimÃ©e Ã  verser au vendeur : ${(animal.prix * visitorInfo.quantity).toLocaleString()} FCFA   
ğŸ“ Localisation : Latitude ${animal.location.latitude}, Longitude ${animal.location.longitude}  

ğŸ‘¤ Acheteur :  
ğŸ”¹ Nom : ${visitorInfo.username}  
ğŸ”¹ Contact : ${visitorInfo.contact}  
ğŸ”¹ E-mail : ${visitorInfo.email}  
ğŸ”¹ Quartier : ${visitorInfo.quartier}  
ğŸ“¦ QuantitÃ© demandÃ©e : ${visitorInfo.quantity}  

ğŸ’° Total Ã  payer : ${totalPrice} FCFA  
ğŸ“ CoordonnÃ©es d'achat : Latitude ${purchaseDetails.location.latitude}, Longitude ${purchaseDetails.location.longitude}  

Merci de confirmer cette commande et de planifier la livraison.

Cordialement,  
Lâ€™Ã©quipe FarmsConnect 
        `;
        console.log("Envoi de l'email Ã  FarmsConnect");
        await sendEmail(emailSubjectFarmsConnect, emailContentFarmsConnect, "kaboreabwa2020@gmail.com");

        console.log("Planification de l'email client");
        await scheduleClientEmail(purchaseDetails);

        console.log("Affichage de l'alerte de confirmation");
        showAlert("Votre achat a Ã©tÃ© confirmÃ© ! Un email contenant les dÃ©tails de votre achat vous a Ã©tÃ© envoyÃ©.");
    } catch (error) {
        console.error("Erreur lors du traitement des emails :", error);
    }
}

// Fonction gÃ©nÃ©rique pour envoyer un email
function sendEmail(subject, content, email) {
    fetch('https://farmsconnect.netlify.app/.netlify/functions/send-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subject, content, email })
    }).then(response => {
        if (response.ok) {
            console.log(`Email envoyÃ© avec succÃ¨s Ã  ${email}.`);
        } else {
            console.error(`Erreur lors de l'envoi de l'email Ã  ${email}.`);
            response.text().then(text => console.error("DÃ©tail de l'erreur :", text));
        }
    }).catch(error => {
        console.error(`Erreur rÃ©seau lors de l'envoi de l'email Ã  ${email} :`, error);
    });
}

// Planification de l'email pour le client
function scheduleClientEmail(purchaseDetails) {
    fetch('https://farmsconnect.netlify.app/.netlify/functions/schedule-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ purchaseDetails, delay: 24 })
    }).then(response => {
        if (response.ok) {
            console.log("Email planifiÃ© pour le client dans 24h.");
        } else {
            console.error("Erreur lors de la planification de l'email.");
        }
    }).catch(error => console.error("Erreur rÃ©seau lors de la planification de l'email :", error));
}



</script>    
    
        </script>
                
            

    <script src="script_Visiter.js"></script>

    <div class="alert hidden" id="customAlert">
        <div class="alert-content">
            <img src="img/FarmsConnect.jpg" alt="FarmsConnect Logo" class="alert-image">
            <p id="alertMessage"></p>
            <button class="alert-close-button" onclick="closeAlert()">Ã—</button>
        </div>
    </div>


</body>
</html>
